{% load thumbnail %}
{% load arkestra_date_tags typogrify_tags humanize thumbnail placeholder_tags %}
{% load mathfilters %}

{% with gamedivision=instance.gamedivision %}


<section>
    <a href="{% url game-division-detail pk=gamedivision.id %}">
        <h4>Дивизион «{{ gamedivision.name }}»</h4>
    </a>

    <div class="row">
        <div class="col-md-12 col-lg-12">
            Команды:
            <table class="game-division-plugin-table">
                <tr>
                    <th>&nbsp;
                    </th>
                    <th class="center">
                        <span title="Игры"  class="text-default visible-lg">
                            Игр
                        </span>
                        <span title="Игры"  class="text-default hidden-lg">
                            И
                        </span>
                        &nbsp;
                    </th>
                    <th class="center">
                        <span title="Победы" class="text-success visible-lg">
                            Выиграли
                        </span>
                        <span title="Игры"  class="text-success hidden-lg">
                            В
                        </span>
                        &nbsp;
                    </th>
                    <th class="center">
                        <span title="Ничьи" class="text-info visible-lg">
                            Ничьи
                        </span>
                        <span title="Игры"  class="text-info hidden-lg">
                            Н
                        </span>
                        &nbsp;
                    </th>
                    <th class="center">
                        <span title="Поражения" class="text-danger visible-lg">
                            Проиграли
                        </span>
                        <span title="Игры"  class="text-danger hidden-lg">
                            П
                        </span>
                        &nbsp;
                    </th>
                    <th class="center">
                        <span title="Очки" class="text-warning visible-lg">
                            Очки
                        </span>
                        <span title="Игры"  class="text-warning hidden-lg">
                            O
                        </span>
                    </th>
                </tr>
                {% for team in gamedivision.teams.all %}
                    <tr>
                        <td class="game-division-plugin-table-name">
                            <a href="{% url team-detail pk=team.id %}">
                                «{{team.name}}»
                            </a>
                            &nbsp;
                        </td>
                        <td class="center">
                            <span title="Игры"  class="text-default">
                                {{team.ngames}}
                            </span>
                            &nbsp;
                        </td>
                        <td class="center">
                            <span title="Победы" class="text-success">
                                {{team.nwins}}
                            </span>
                            &nbsp;
                        </td>
                        <td class="center">
                            <span title="Ничьи" class="text-info">
                                {{team.ndraws}}
                            </span>
                            &nbsp;
                        </td>
                        <td class="center">
                            <span title="Поражения" class="text-danger">
                                {{team.nloses}}
                            </span>
                            &nbsp;
                        </td>
                        <td class="center">
                            <span title="Очки" class="text-warning">
                                {{team.npoints}}
                            </span>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
        <div class="col-md-12 col-lg-12">
            <hr/>
        </div>
        <div class="col-md-12 col-lg-12">
            <p class="row">
                <div class="col-lg-3 col-md-6  col-sm-12 col-xs-6">
                    {% with p2t=gamedivision.get_max_ngoalsntrans_p2t %}
                        {% with player=p2t.player %}
                        {% if player %}
                            <p class="center">
                                Лучший бомбардир
                                <a title="Лучший бомбардир" href="{% url player-detail pk=player.id %}">
                                    <div class="center" >
                                        {% if player.image %}
                                            <img  class="img-thumbnail" src="{% thumbnail player.image 128x128 crop %}"
                                                {% if player.image.alt %}
                                                    alt="{{ player.image.alt }}"
                                                {% endif %}
                                            />
                                        {% else %}
                                            <div class="img-null p128x128 img-thumbnail">
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="center" >
                                        {{player.second_name}}
                                        {{player.first_name}}
                                    </div>
                                </a>
                            </p>
                        {% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                <div class="col-lg-3 col-md-6  col-sm-12 col-xs-6">
                    {% with p2t=gamedivision.get_max_ngoals_p2t %}
                        {% with player=p2t.player %}
                        {% if player %}
                            <p class="center">
                                Лучший снайпер
                                <a title="Лучший снайпер" href="{% url player-detail pk=player.id %}">
                                    <div class="center" >
                                        {% if player.image %}
                                            <img  class="img-thumbnail" src="{% thumbnail player.image 128x128 crop %}"
                                                {% if player.image.alt %}
                                                    alt="{{ player.image.alt }}"
                                                {% endif %}
                                            />
                                        {% else %}

                                                {% if p2t.image %}
                                                    <img  class="img-thumbnail" src="{% thumbnail p2t.image 128x128 crop %}"
                                                        {% if p2t.image.alt %}
                                                            alt="{{ p2t.image.alt }}"
                                                        {% endif %}
                                                    />
                                                {% else %}
                                                    <div class="img-null p128x128 img-thumbnail">
                                                    </div>
                                                {% endif %}

                                        {% endif %}
                                    </div>
                                    <div class="center" >
                                        {{player.second_name}}
                                        {{player.first_name}}
                                    </div>
                                </a>
                            </p>
                        {% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                <div class="col-lg-3 col-md-6  col-sm-12 col-xs-6">
                    {% with p2t=gamedivision.get_max_ntrans_p2t %}
                        {% with player=p2t.player %}
                        {% if player %}

                            <p class="center">
                                Лучший ассистент
                                <a title="Лучший ассистент" href="{% url player-detail pk=player.id %}">
                                    <div class="center" >
                                        {% if player.image %}
                                            <img  class="img-thumbnail" src="{% thumbnail player.image 128x128 crop %}"
                                                {% if player.image.alt %}
                                                    alt="{{ player.image.alt }}"
                                                {% endif %}
                                            />
                                        {% else %}
                                            {% if p2t.image %}
                                                <img  class="img-thumbnail" src="{% thumbnail p2t.image 128x128 crop %}"
                                                    {% if p2t.image.alt %}
                                                        alt="{{ p2t.image.alt }}"
                                                    {% endif %}
                                                />
                                            {% else %}
                                                <div class="img-null p128x128 img-thumbnail">
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="center" >
                                        {{player.second_name}}
                                        {{player.first_name}}
                                    </div>
                                </a>
                            </p>
                        {% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
                <div class="col-lg-3 col-md-6  col-sm-12 col-xs-6">
                    {% with p2t=gamedivision.get_min_safety_factor_p2t %}
                        {% with player=p2t.player %}
                        {% if player %}
                            <p class="center">
                                Лучший вратарь
                                <a title="Лучший вратарь" href="{% url player-detail pk=player.id %}">
                                    <div class="center" >
                                        {% if player.image %}
                                            <img  class="img-thumbnail" src="{% thumbnail player.image 128x128 crop %}"
                                                {% if player.image.alt %}
                                                    alt="{{ player.image.alt }}"
                                                {% endif %}
                                            />
                                        {% else %}
                                            {% if p2t.image %}
                                                <img  class="img-thumbnail" src="{% thumbnail p2t.image 128x128 crop %}"
                                                    {% if p2t.image.alt %}
                                                        alt="{{ p2t.image.alt }}"
                                                    {% endif %}
                                                />
                                            {% else %}
                                                <div class="img-null p128x128 img-thumbnail">
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                    <div class="center" >
                                        {{player.second_name}}
                                        {{player.first_name}}
                                    </div>
                                </a>
                            </p>
                        {% endif %}
                        {% endwith %}
                    {% endwith %}
                </div>
            </p>
        </div>
    </div>

    {% for gametournamentplayoff in gamedivision.gametournamentplayoffs.all %}
        <div>
            <h5>Play-Off</h5>
            <div class="small-text-all">


                {% regroup gametournamentplayoff.gamematch_set.all|dictsortreversed:"finaltype_id" by finaltype as gamegroup_list %}

                <table class="table table-striped">
                    <tr>
                        {% for gamegroup in gamegroup_list %}
                            <th class="center">{{gamegroup.grouper.detail}}</th>
                        {% endfor %}
                    </tr>
                    <tr style="vetical-aligment: top">
                        {% for gamegroup in gamegroup_list %}
                            {% with offset=forloop.counter %}

                            <td>
                                {% for gamematch in gamegroup.list %}
                                    {% if gamegroup.grouper.id != -3 %}
                                        {% if forloop.last %}
                                            <div style="margin-top:{{offset|mul:'100'|sub:'100'}}px;">
                                        {% else %}
                                            <div style="margin-top:{{offset|mul:'100'|sub:'100'}}px;margin-bottom:{{offset|mul:'150'}}px">
                                        {% endif %}
                                    {% else %}
                                    <div style="margin-top:{{offset|mul:'100'|sub:'150'}}px;">
                                    {% endif %}
                                        <div class="center">
                                            {% if gamematch.start_datetime %}
                                                <span class="datetime-mark" title="Дата">
                                                    <span>{{gamematch.start_datetime|date:"d M Y H:i"}}&nbsp;</span>
                                                </span>
                                            {% endif %}
                                        </div>
                                            <div>
                                                <div class="col-md-12 center">
                                                    {% with team=gamematch.team_a  %}
                                                        {% if team.name %}
                                                            <div>
                                                                <a href="{% url team-detail pk=team.id %}">
                                                                    {% if gamematch.score_a > gamematch.score_b %}
                                                                        <b>{{team.name}}</b>
                                                                    {% else %}
                                                                        {{team.name}}
                                                                    {% endif %}
                                                                </a>
                                                            </div>
                                                        {% endif %}
                                                    {% endwith %}
                                                </div>
                                                <div class="col-md-12 center">
                                                    <a href="{% url game-match-detail pk=gamematch.id %}">
                                                        <span class="center">
                                                            {{gamematch.score_a|default_if_none:"?"}}&nbsp;:&nbsp;{{gamematch.score_b|default_if_none:"?"}}
                                                        </span>
                                                    </a>
                                                </div>
                                                <div class="col-md-12 center">
                                                    {% with team=gamematch.team_b  %}
                                                        {% if team.name %}
                                                            <div>
                                                                <a href="{% url team-detail pk=team.id %}">
                                                                    {% if gamematch.score_a < gamematch.score_b %}
                                                                        <b>{{team.name}}</b>
                                                                    {% else %}
                                                                        {{team.name}}
                                                                    {% endif %}
                                                                </a>
                                                            </div>
                                                        {% endif %}
                                                    {% endwith %}
                                                </div>
                                            </div>
                                    </div>
                                {% endfor %}
                            </td>
                            {% endwith %}
                        {% endfor %}
                    </tr>
                </table>
            </div>


        <div>
    {% endfor %}

</section>



{% endwith %}
